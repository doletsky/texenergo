function JCTitleSearch(e){var t=this;this.arParams={AJAX_PAGE:e.AJAX_PAGE,CONTAINER_ID:e.CONTAINER_ID,INPUT_ID:e.INPUT_ID,MIN_QUERY_LEN:parseInt(e.MIN_QUERY_LEN)},e.WAIT_IMAGE&&(this.arParams.WAIT_IMAGE=e.WAIT_IMAGE),e.MIN_QUERY_LEN<=0&&(e.MIN_QUERY_LEN=1),this.cache=[],this.cache_key=null,this.startText="",this.currentRow=-1,this.RESULT=null,this.CONTAINER=null,this.INPUT=null,this.WAIT=null,this.ShowResult=function(e){var a=BX.pos(t.CONTAINER);a.width=a.right-a.left,t.RESULT.style.position="absolute",t.RESULT.style.top=a.bottom+2+"px",t.RESULT.style.left=a.left+"px",t.RESULT.style.width=a.width+"px",null!=e&&(t.RESULT.innerHTML=e),t.RESULT.innerHTML.length>0?t.RESULT.style.display="block":t.RESULT.style.display="none";var i,r=BX.findChild(t.RESULT,{tag:"table","class":"title-search-result"},!0);if(r&&(i=BX.findChild(r,{tag:"th"},!0)),i){var o=BX.pos(r);o.width=o.right-o.left;var n=BX.pos(i);n.width=n.right-n.left,i.style.width=n.width+"px",t.RESULT.style.width=a.width+n.width+"px",t.RESULT.style.left=a.left-n.width-1+"px",o.width-n.width>a.width&&(t.RESULT.style.width=a.width+n.width-1+"px"),o=BX.pos(r);var s=BX.pos(t.RESULT);s.right>o.right&&(t.RESULT.style.width=o.right-o.left+"px")}var l;r&&(l=BX.findChild(t.RESULT,{"class":"title-search-fader"},!0)),l&&i&&(s=BX.pos(t.RESULT),l.style.left=s.right-s.left-18+"px",l.style.width="18px",l.style.top="0px",l.style.height=s.bottom-s.top+"px",l.style.display="block")},this.onKeyPress=function(e){var a=BX.findChild(t.RESULT,{tag:"table","class":"title-search-result"},!0);if(!a)return!1;var i=a.rows.length;switch(e){case 27:return t.RESULT.style.display="none",t.currentRow=-1,t.UnSelectAll(),!0;case 40:"none"==t.RESULT.style.display&&(t.RESULT.style.display="block");for(var r=-1,o=0;i>o;o++)if(!BX.findChild(a.rows[o],{"class":"title-search-separator"},!0)){if(-1==r&&(r=o),t.currentRow<o){t.currentRow=o;break}"title-search-selected"==a.rows[o].className&&(a.rows[o].className="")}return o==i&&t.currentRow!=o&&(t.currentRow=r),a.rows[t.currentRow].className="title-search-selected",!0;case 38:"none"==t.RESULT.style.display&&(t.RESULT.style.display="block");for(var n=-1,o=i-1;o>=0;o--)if(!BX.findChild(a.rows[o],{"class":"title-search-separator"},!0)){if(-1==n&&(n=o),t.currentRow>o){t.currentRow=o;break}"title-search-selected"==a.rows[o].className&&(a.rows[o].className="")}return 0>o&&t.currentRow!=o&&(t.currentRow=n),a.rows[t.currentRow].className="title-search-selected",!0;case 13:if("block"==t.RESULT.style.display)for(var o=0;i>o;o++)if(t.currentRow==o&&!BX.findChild(a.rows[o],{"class":"title-search-separator"},!0)){var s=BX.findChild(a.rows[o],{tag:"a"},!0);if(s)return window.location=s.href,!0}return!1}return!1},this.onTimeout=function(){if(t.INPUT.value!=t.oldValue&&t.INPUT.value!=t.startText)if(t.INPUT.value.length>=t.arParams.MIN_QUERY_LEN)if(t.oldValue=t.INPUT.value,t.cache_key=t.arParams.INPUT_ID+"|"+t.INPUT.value,null==t.cache[t.cache_key]){if(t.WAIT){var e=BX.pos(t.INPUT),a=e.bottom-e.top-2;t.WAIT.style.top=e.top+1+"px",t.WAIT.style.height=a+"px",t.WAIT.style.width=a+"px",t.WAIT.style.left=e.right-a+2+"px",t.WAIT.style.display="block"}BX.ajax.post(t.arParams.AJAX_PAGE,{ajax_call:"y",INPUT_ID:t.arParams.INPUT_ID,q:t.INPUT.value,l:t.arParams.MIN_QUERY_LEN},function(e){t.cache[t.cache_key]=e,t.ShowResult(e),t.currentRow=-1,t.EnableMouseEvents(),t.WAIT&&(t.WAIT.style.display="none"),setTimeout(t.onTimeout,500)})}else t.ShowResult(t.cache[t.cache_key]),t.currentRow=-1,t.EnableMouseEvents(),setTimeout(t.onTimeout,500);else t.RESULT.style.display="none",t.currentRow=-1,t.UnSelectAll(),setTimeout(t.onTimeout,500);else setTimeout(t.onTimeout,500)},this.UnSelectAll=function(){var e=BX.findChild(t.RESULT,{tag:"table","class":"title-search-result"},!0);if(e)for(var a=e.rows.length,i=0;a>i;i++)e.rows[i].className=""},this.EnableMouseEvents=function(){var e=BX.findChild(t.RESULT,{tag:"table","class":"title-search-result"},!0);if(e)for(var a=e.rows.length,i=0;a>i;i++)BX.findChild(e.rows[i],{"class":"title-search-separator"},!0)||(e.rows[i].id="row_"+i,e.rows[i].onmouseover=function(){t.currentRow!=this.id.substr(4)&&(t.UnSelectAll(),this.className="title-search-selected",t.currentRow=this.id.substr(4))},e.rows[i].onmouseout=function(){this.className="",t.currentRow=-1})},this.onFocusLost=function(){setTimeout(function(){t.RESULT.style.display="none"},250)},this.onFocusGain=function(){t.RESULT.innerHTML.length&&t.ShowResult()},this.onKeyDown=function(e){return e||(e=window.event),"block"==t.RESULT.style.display&&t.onKeyPress(e.keyCode)?BX.PreventDefault(e):void 0},this.Init=function(){this.CONTAINER=document.getElementById(this.arParams.CONTAINER_ID),this.RESULT=document.body.appendChild(document.createElement("DIV")),this.RESULT.className="title-search-result",this.INPUT=document.getElementById(this.arParams.INPUT_ID),this.startText=this.oldValue=this.INPUT.value,BX.bind(this.INPUT,"focus",function(){t.onFocusGain()}),BX.bind(this.INPUT,"blur",function(){t.onFocusLost()}),BX.browser.IsSafari()||BX.browser.IsIE()?this.INPUT.onkeydown=this.onKeyDown:this.INPUT.onkeypress=this.onKeyDown,this.arParams.WAIT_IMAGE&&(this.WAIT=document.body.appendChild(document.createElement("DIV")),this.WAIT.style.backgroundImage="url('"+this.arParams.WAIT_IMAGE+"')",BX.browser.IsIE()||(this.WAIT.style.backgroundRepeat="none"),this.WAIT.style.display="none",this.WAIT.style.position="absolute",this.WAIT.style.zIndex="1100"),setTimeout(this.onTimeout,500)},BX.ready(function(){t.Init(e)})}
