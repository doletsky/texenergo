function JCSmartFilter(t){this.ajaxURL=t,this.form=null,this.timer=null}JCSmartFilter.prototype.keyup=function(t){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){this.reload(t)},this),1e3)},JCSmartFilter.prototype.click=function(t){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){this.reload(t)},this),1e3)},JCSmartFilter.prototype.reload=function(t){if(this.position=BX.pos(t,!0),this.form=BX.findParent(t,{tag:"form"}),this.form){var e=new Array;e[0]={name:"ajax",value:"y"},this.gatherInputsValues(e,BX.findChildren(this.form,{tag:"input"},!0)),BX.ajax.loadJSON(this.ajaxURL,this.values2post(e),BX.delegate(this.postHandler,this))}},JCSmartFilter.prototype.postHandler=function(t){if(t.ITEMS){for(var e in t.ITEMS){var a=t.ITEMS[e];if("N"==a.PROPERTY_TYPE||a.PRICE);else if(a.VALUES)for(var i in a.VALUES){var r=a.VALUES[i],n=BX(r.CONTROL_ID);n&&(n.parentNode.className=r.DISABLED?"lvl2 lvl2_disabled":"lvl2")}}var l=BX("modef"),s=BX("modef_num");if(l&&s){s.innerHTML=t.ELEMENT_COUNT;var o=BX.findChildren(l,{tag:"A"},!0);if(t.FILTER_URL&&o&&(o[0].href=BX.util.htmlspecialcharsback(t.FILTER_URL)),t.FILTER_AJAX_URL&&t.COMPONENT_CONTAINER_ID&&BX.bind(o[0],"click",function(e){var a=BX.util.htmlspecialcharsback(t.FILTER_AJAX_URL);return BX.ajax.insertToNode(a,t.COMPONENT_CONTAINER_ID),BX.PreventDefault(e)}),t.INSTANT_RELOAD&&t.COMPONENT_CONTAINER_ID){var c=BX.util.htmlspecialcharsback(t.FILTER_AJAX_URL);BX.ajax.insertToNode(c,t.COMPONENT_CONTAINER_ID)}else"none"==l.style.display&&(l.style.display="block"),l.style.top=this.position.top+"px"}}},JCSmartFilter.prototype.gatherInputsValues=function(t,e){if(e)for(var a=0;a<e.length;a++){var i=e[a];if(!i.disabled&&i.type)switch(i.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":i.value.length&&(t[t.length]={name:i.name,value:i.value});break;case"radio":case"checkbox":i.checked&&(t[t.length]={name:i.name,value:i.value});break;case"select-multiple":for(var r=0;r<i.options.length;r++)i.options[r].selected&&(t[t.length]={name:i.name,value:i.options[r].value})}}},JCSmartFilter.prototype.values2post=function(t){for(var e=new Array,a=e,i=0;i<t.length;){var r=t[i].name.indexOf("[");if(-1==r)a[t[i].name]=t[i].value,a=e,i++;else{var n=t[i].name.substring(0,r),l=t[i].name.substring(r+1);a[n]||(a[n]=new Array);var s=l.indexOf("]");-1==s?(a=e,i++):0==s?(a=a[n],t[i].name=""+a.length):(a=a[n],t[i].name=l.substring(0,s)+l.substring(s+1))}}return e};
