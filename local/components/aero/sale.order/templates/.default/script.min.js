$(function(){function e(){$("input[name='oter-delivery-type-selector']").each(function(){wrapBlock=$(this).closest("header").next(".other_type_wrap"),$(this).is(":checked")?(wrapBlock.removeClass("inactive"),wrapBlock.find(".delivery_type_overlay").remove(),wrapBlock.find("input, select").each(function(){$(this).attr("name",$(this).attr("original_name"))}),wrapBlock.find("input.tmpRequired, select.tmpRequired").removeClass("tmpRequired").addClass("required")):(wrapBlock.append('<div class="delivery_type_overlay"></div>'),wrapBlock.addClass("inactive"),wrapBlock.find("input, select").each(function(){$(this).attr("original_name",$(this).attr("name")),$(this).attr("name","tmp_"+$(this).attr("name"))}),wrapBlock.find("input.required, select.required").removeClass("required").addClass("tmpRequired"),wrapBlock.find("input").val(""))})}$(".crumbsDisabled").click(function(e){e.preventDefault()}),$("input[name='oter-delivery-type-selector']").click(function(){e()}),e(),$(".phone-mask").mask("+7(999) 999-99-99"),$(".orderTabs").on("easytabs:after",function(){if($("#group_msc").is(":visible")){var e=0;$(".subTabs>ul>li>a").each(function(){$(this).height()>e&&(e=$(this).height())}),$(".subTabs>ul>li>a").each(function(){var t=e-$(this).height()+20;$(this).css({paddingTop:t/2+"px",paddingBottom:t/2+"px"})});var t=$(".delivery-msc:visible");$("#deliveryTitle").html(t.data("title")),$("#deliveryPrice").html(t.data("price")),$(".delivery-msc:visible").trigger("calculate")}$("#group_later").is(":visible")?$(".asideCourier").slideUp(300):$(".asideCourier").slideDown(300)}),$(".orderTabs").each(function(){var e=$(this),t=$(">ul>li.preactive",e).size()>0?"li.preactive":"li:last-child";e.easytabs({updateHash:!1,defaultTab:t}),"li.preactive"==t&&setTimeout(function(){e.trigger("easytabs:after")},500)}),$(".selectProfile").on("click",function(e){e.preventDefault();var t=$(this).closest(".orderProfile");return t.hasClass("selected")?(t.removeClass("selected"),$(this).removeClass("orange")):($(".orderProfile.selected .selectProfile").removeClass("orange"),$(".orderProfile.selected").removeClass("selected"),t.addClass("selected"),$(this).addClass("orange")),$(".orderProfile.selected").size()>0?$("#deliveryForm").fadeOut(500,function(){$("#profilesForm").show()}):($("#profilesForm").hide(),$("#deliveryForm").fadeIn(500)),$("input[name=PROFILE_ID]").val(t.data("id")),!1}),$(".logisticBox input").on("change",function(e){e.preventDefault();var t=$(this).closest(".logisticBox");return $(".logisticBox").removeClass("active"),t.addClass("active"),$("#deliveryTitle").html(t.data("title")),$("#deliveryPrice").html(t.data("price")),!1}),$(".logisticBox.active").size()<=0?$(".logisticBox:first input").attr("checked",!0):$("#group_later").is(":visible")?$(".asideCourier").slideUp(300):$(".asideCourier").slideDown(300),$(".go-delivery").on("click",function(e){return e.preventDefault(),$("input[name=confirm_order]").val("no"),$("#order_form_confirm").submit(),!1}),$(".radioCaption").on("click",function(){var e=$(this).attr("for");$("#"+e).attr("checked",!0)});var t;$(window).on("resize",function(){var e=$(".fancybox-inner .map-zones");e.size()&&(e.width($(".fancybox-inner").width()-310),e.height($(".fancybox-inner").height()))}),$("body").on("popup_init",function(e,a){var i=$(".map-zones",a);i.size()&&(i.width($(".fancybox-inner").width()-310),i.height($(".fancybox-inner").height()),t&&t.remove(),t=DG.map(i[0],{center:[55.749213509661,37.617202740498],zoom:10,fullscreenControl:!1}),$.get("/local/components/aero/sale.order/zones.php",{},function(e){DG.geoJson(e,{onEachFeature:function(e,t){t.bindPopup("<b>"+e.properties.Name+"</b><br>"+e.properties.Description)},style:function(e){return{color:e.style.fill,stroke:!0,weight:e.style.stroke,fillOpacity:e.style.opacity}}}).addTo(t)},"json"),$(".map-zones-form").trigger("show"),$(".map-zones-form").trigger("search"))}),$(".map-zones-form").on("show",function(){var e=$(".delivery-msc.active"),t=$('input[name="PROFILE[LOCATION_DELIVERY]_val"]',e).val(),a=$('input[name="PROFILE[LOCATION_DELIVERY]"]',e).val();$('input[name="PROFILE[LOCATION_DELIVERY_POPUP]_val"]').val(t),$('input[name="PROFILE[LOCATION_DELIVERY_POPUP]"]').val(a),$("#search_street").val($('[name="PROFILE[STREET_DELIVERY]"]',e).val()),$("#search_house").val($('[name="PROFILE[HOUSE_DELIVERY]"]',e).val()),$("#search_housing").val($('[name="PROFILE[HOUSING_DELIVERY]"]',e).val())}),$(".map-zones-form .formInput").on("keyup",function(){$(".map-zones-form").trigger("search")});var a,i,r,n,o;$('input[name="PROFILE[LOCATION_DELIVERY_POPUP]_val"]').on("location-selected",function(){$(".map-zones-form").trigger("search")}),$(".map-zones-form").on("search",function(){var e=$('input[name="PROFILE[LOCATION_DELIVERY_POPUP]_val"]').val();if(!e||e.length<=0)e="Москва";else{var s=e.indexOf("(");e=e.substr(0,s)}clearTimeout(a),a=setTimeout(function(){var a="г. "+e+", "+$("#search_street").val()+", "+$("#search_house").val();$("#search_housing").val()&&(a+=" ст"+$("#search_housing").val()),DG.ajax({url:"http://catalog.api.2gis.ru/geo/search",data:{key:"ruxlih0718",version:1.3,q:a},type:"GET",success:function(e){"undefined"!=typeof o&&t.removeLayer(o),e.result?(i=DG.Wkt.toPoints(e.result[0].centroid),n=i[0],r=i[1],o=DG.marker([r,n]).bindPopup(e.result[0].name),t.addLayer(o),t.panTo([r,n]),t.setZoom(16)):t.setZoom(10)},error:function(){t.panTo([55.749213509661,37.617202740498]),t.setZoom(10)}})},500)}),$(".map-zones-form button").on("click",function(e){e.preventDefault();var t=$(".delivery-msc.active");$('[name="PROFILE[STREET_DELIVERY]"]',t).val($("#search_street").val()),$('[name="PROFILE[HOUSE_DELIVERY]"]',t).val($("#search_house").val()),$('[name="PROFILE[HOUSING_DELIVERY]"]',t).val($("#search_housing").val());var a=$('input[name="PROFILE[LOCATION_DELIVERY_POPUP]_val"]').val(),i=$('input[name="PROFILE[LOCATION_DELIVERY_POPUP]"]').val();return $('input[name="PROFILE[LOCATION_DELIVERY]_val"]',t).val(a),$('input[name="PROFILE[LOCATION_DELIVERY]"]',t).val(i),$(".delivery-msc.active").trigger("calculate"),$.fancybox.close(),!1}),$(".delivery-msc .deliveryForm .formInput").on("change",function(){$(this).closest(".delivery-msc").trigger("calculate")}),$(".delivery-msc").on("calculate",function(){var e=$(this),t=$('[name="PROFILE[LOCATION_DELIVERY]"]',e).val(),a=$('[name="PROFILE[STREET_DELIVERY]"]',e).val(),i=$('[name="PROFILE[HOUSE_DELIVERY]"]',e).val(),r=$('[name="DELIVERY_ID"]',e).val();$.get(document.location,{calc_delivery:"yes",DELIVERY_ID:r,LOCATION_ID:t,STREET:a,HOUSE:i},function(t){t.ZONE&&t.ZONE.length?($(".current-zone-price",e).html("Москва и область, "+t.ZONE+", "+t.VALUE+"руб."),$("#delivery_calc_result > span").text(t.VALUE)):$(".current-zone-price",e).html(""),$("#deliveryPrice").html(t.VALUE)},"json")}),$(".shippingClose").on("click",function(e){e.preventDefault();var t=$(this).data("id"),a=$(this).closest(".orderProfile");return $.post(document.location,{delete_profile:"yes",id:t},function(e){e.success&&(1==$(".orderProfile").size()?a.closest(".optionsWrapper").remove():a.remove())},"json"),!1})});
