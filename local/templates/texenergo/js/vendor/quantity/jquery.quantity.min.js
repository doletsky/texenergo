!function(t){var e=function(e,i){this.container=t('<div class="quantity-container"><span class="minus">-</span><input type="number" class="value" pattern="[0-9]*" value="0" maxlength="5" max="99999"><span class="plus">+</span></div>'),this.el=t(e),this.el.hasClass("jq-quantity")||this.init(i)};e.prototype={init:function(e){var i=this;i.options=t.extend({},i.defaults,e),i.oldval=i.el.val(),i.curval=i.el.val(),t(this.options.value,this.container).val(this.curval),i.options.minValue=i.el.attr("min")||i.options.minValue,i.options.maxValue=i.el.attr("max")||i.options.maxValue;var n=t("<input/>",{type:"hidden"}),a=i.el.prop("attributes");t.each(a,function(){"type"!=this.name&&n.attr(this.name,this.value)}),n.addClass("jq-quantity"),i.el.after(n),i.el.remove(),i.el=n,i.el.after(i.container),i.container.attr("unselectable","on").css("user-select","none").on("selectstart",!1),i.container.find(i.options.plus).on("click",function(t){return i.curval++,i.refresh(),t.preventDefault(),!1}),i.container.find(i.options.minus).on("click",function(t){return i.curval>i.options.minValue&&(i.curval--,i.refresh()),t.preventDefault(),!1}),i.el.on("qty:change",function(){i.curval=i.el.val(),i.refresh()});var s,o;i.container.find(i.options.plus).on("mousedown",function(){s=setTimeout(function(){o=setInterval(function(){return i.curval>=i.options.maxValue?(clearInterval(o),!1):void("y"!=i.attr("busy")&&(i.curval++,i.refresh()))},100)},500)}),i.container.find(i.options.minus).on("mousedown",function(){s=setTimeout(function(){o=setInterval(function(){return i.curval<=i.options.minValue?(clearInterval(o),!1):void("y"!=i.attr("busy")&&(i.curval--,i.refresh()))},100)},500)}),t("body").on("mouseup",function(){clearInterval(s),clearInterval(o)}),t(this.options.value,this.container).on("keyup",function(){var e=t(this).val().replace(/[^\d+]/g,"");i.curval=e,t(this).val(e),i.refresh()}),i.refresh()},refresh:function(){this.oldval!=this.curval&&(t(this.options.value,this.container).val(this.curval),this.container.trigger("change",[this.curval]),this.el.val(this.curval),this.el.trigger("change"),this.oldval=this.curval)},value:function(){return this.curval}},e.prototype.defaults={current:1,minValue:1,maxValue:9999,plus:".plus",minus:".minus",value:".value"},t.fn.Quantity=function(i){var n=Array.prototype.slice.call(arguments,1);return this.each(function(){var a=t(this),s=a.data("Quantity");return s||a.data("Quantity",s=new e(this,i)),"string"==typeof i?s[i].apply(s,n):void 0})},t(function(){t("input.quantity").Quantity()})}(jQuery);
