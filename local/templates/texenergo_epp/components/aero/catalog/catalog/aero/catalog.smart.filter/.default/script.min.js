function JCSmartFilter(e){this.ajaxURL=e,this.form=null,this.timer=null}JCSmartFilter.prototype.keyup=function(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){this.reload(e)},this),1e3)},JCSmartFilter.prototype.click=function(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){this.reload(e)},this),1e3)},JCSmartFilter.prototype.reload=function(e){if(this.position=$(e).closest(".sidebar-item").position(),this.form=BX.findParent(e,{tag:"form"}),this.form){var t=new Array;t[0]={name:"ajax",value:"y"},this.gatherInputsValues(t,BX.findChildren(this.form,{tag:["input","select"]},!0)),BX.ajax.loadJSON(this.ajaxURL,this.values2post(t),BX.delegate(this.postHandler,this))}},JCSmartFilter.prototype.postHandler=function(e){if(e.ITEMS){for(var t in e.ITEMS){var i=e.ITEMS[t];if("N"==i.PROPERTY_TYPE||i.PRICE);else if(i.VALUES)for(var n in i.VALUES)var a=i.VALUES[n],s=BX(a.CONTROL_ID)}var o=BX("modef"),r=BX("modef_num");if(o&&r){r.innerHTML=e.ELEMENT_COUNT;var l=BX.findChildren(o,{tag:"A"},!0);if(e.FILTER_URL&&l&&(l[0].href=BX.util.htmlspecialcharsback(e.FILTER_URL)),e.FILTER_AJAX_URL&&e.COMPONENT_CONTAINER_ID&&BX.bind(l[0],"click",function(t){var i=BX.util.htmlspecialcharsback(e.FILTER_AJAX_URL);return BX.ajax.insertToNode(i,e.COMPONENT_CONTAINER_ID),BX.PreventDefault(t)}),e.INSTANT_RELOAD&&e.COMPONENT_CONTAINER_ID){var c=BX.util.htmlspecialcharsback(e.FILTER_AJAX_URL);BX.ajax.insertToNode(c,e.COMPONENT_CONTAINER_ID)}else"none"==o.style.display&&(o.style.display="block"),o.style.top=this.position.top+"px"}}},JCSmartFilter.prototype.gatherInputsValues=function(e,t){if(t)for(var i=0;i<t.length;i++){var n=t[i];if(!n.disabled&&n.type)switch(n.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":n.value.length&&"от"!==n.value&&"до"!==n.value&&(e[e.length]={name:n.name,value:n.value});break;case"select":case"select-one":for(var a=0;a<n.options.length;a++)if(n.options[a].selected&&n.options[a].value.length>0){e[e.length]={name:n.name+"_"+n.options[a].value,value:"Y"};break}break;case"radio":n.checked&&n.value>0&&(e[e.length]={name:n.name+"_"+n.value,value:"Y"});break;case"checkbox":n.checked&&(e[e.length]={name:n.name,value:n.value});break;case"select-multiple":for(var a=0;a<n.options.length;a++)n.options[a].selected&&(e[e.length]={name:n.name,value:n.options[a].value})}}},JCSmartFilter.prototype.values2post=function(e){for(var t=new Array,i=t,n=0;n<e.length;){var a=e[n].name.indexOf("[");if(-1==a)i[e[n].name]=e[n].value,i=t,n++;else{var s=e[n].name.substring(0,a),o=e[n].name.substring(a+1);i[s]||(i[s]=new Array);var r=o.indexOf("]");-1==r?(i=t,n++):0==r?(i=i[s],e[n].name=""+i.length):(i=i[s],e[n].name=o.substring(0,r)+o.substring(r+1))}}return t};
