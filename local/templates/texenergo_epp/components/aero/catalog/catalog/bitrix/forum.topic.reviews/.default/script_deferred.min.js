function replyActionComment(e,t){if(!BX.util.in_array(t,["DEL","MODERATE"]))return!1;if("DEL"==t&&!confirm(oText.cdm))return!1;var i=e.getAttribute("href");i=i.replace(/.AJAX_CALL=Y/g,"").replace(/.sessid=[^&]*/g,""),i+=(i.indexOf("?")>-1?"&":"?")+"AJAX_CALL=Y&sessid="+phpVars.bitrix_sessid,BX.hide(e.parentNode);var a=BX.create("a",{attrs:{className:"reply-action-note"}});a.innerHTML=oText.wait,e.parentNode.parentNode.appendChild(a);var o=function(){BX.remove(a),BX.show(e.parentNode)};return BX.ajax.loadJSON(i,function(s){var r=BX.findParent(e,{tag:"table"});if(s.status&&r){BX.onCustomEvent(window,"onForumCommentAJAXAction",[t]);var n=window.curpage||top.window.location.href;if("DEL"==t)BX.fx.hide(r,"scroll",{time:.15,callback_complete:function(){BX.remove(r);var e=BX.findChild(document,{"class":"reviews-post-table"},!0,!0);(!e||e.length<1)&&"undefined"!=typeof oForum&&oForum.page_number>1&&BX.reload(n),o()}});else{var l=BX.hasClass(r,"reviews-post-hidden"),c=l?oText.hide:oText.show,d=BX.findChild(r,{className:"reviews-text"},!0);BX.fx.hide(d,"fade",{time:.1,callback_complete:function(){BX.toggleClass(r,"reviews-post-hidden"),e.innerHTML=c,i=i.replace(new RegExp("REVIEW_ACTION="+(l?"SHOW":"HIDE")),"REVIEW_ACTION="+(l?"HIDE":"SHOW")),e.setAttribute("href",i),BX.fx.show(d,"fade",{time:.1}),o(),BX.style(d,"background-color",l?"#FFFFFF":"#E5F8E3")}})}}else BX.addClass(a,"error"),a.innerHTML='<font class="errortext">'+s.message+"</font>"}),!1}function fTextToNode(e){var t=BX.create("div");return t.innerHTML=e,t.childNodes.length>0?t:null}function PostFormAjaxStatus(e){var t=BX.findChild(document,{className:"reviews-note-box"},!0,!0);if(t)for(i in t)BX.remove(t[i]);var a=BX.findChild(document,{className:"reviews-block-container"},!0);if(a&&!(e.length<1)){var o=fTextToNode(e);if(o)for(var s=["reviews-reply-form","reviews-collapse"],r=a;r=r.nextSibling;)if(1==r.nodeType){var n=!1;for(i in s)if(BX.hasClass(r,s[i])){n=!0;break}if(n){r.parentNode.insertBefore(o,r);break}}}}function PostFormAjaxNavigation(e,t,a){var o=fTextToNode(e);if(o){var s=BX.findChildren(document,{className:"reviews-navigation-box"},!0);if(!s){var r=BX.findChild(document,{className:"reviews-block-container"},!0);if(!r)return!1;var n=r.parentNode;n.insertBefore(BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-top"}}),r);do r=r.nextSibling;while(r&&1!=r.nodeType);var l=BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-bottom"}});r?r.parentNode.insertBefore(l,r):n.appendChild(l);var s=BX.findChildren(document,{className:"reviews-navigation-box"},!0)}for(i in s)s[i].innerHTML=o.innerHTML;oForum.page_number=t,oForum.page_count=a}}function SetReviewsAjaxPostTmp(e){window.forumAjaxPostTmp=e}function fReplaceOrInsertNode(e,t,i,a){var o=null;return BX.type.isDomNode(i)?!BX.type.isDomNode(e)&&!BX.type.isArray(e)&&e.length>0&&!(e=fTextToNode(e))?!1:(BX.type.isDomNode(t)&&(i=t.parentNode,o=t.nextSibling,i.removeChild(t)),o||(o=BX.findChild(i,a,!0)),o?o.parentNode.insertBefore(e,o):i.appendChild(e),!0):!1}function fRunScripts(e){var t=BX.processHTML(e,!0);scripts=t.SCRIPT,BX.ajax.processScripts(scripts,!0)}function PostFormAjaxResponse(e,t,i){t.BXFormSubmit_save=null;var a=window.forumAjaxPostTmp,o={className:/reviews-reply-form|reviews-collapse/};BX.onCustomEvent(window,"onForumCommentAJAXPost",[a,t]);var s=window.curpage||top.window.location.href;if("undefined"==typeof a)return void BX.reload(s);var r=BX.findChild(document,{className:"reviews-block-inner"},!0);if(!r){var n=BX.create("div",{props:{className:"reviews-block-container reviews-reviews-block-container"},children:[BX.create("div",{props:{className:"reviews-block-outer"},children:[BX.create("div",{props:{className:"reviews-block-inner"}})]})]});fReplaceOrInsertNode(n,null,BX.findChild(document,o,!0).parentNode,o),r=BX.findChild(document,{className:"reviews-block-inner"},!0)}if(a.reload&&BX.reload(s),a.status){if(a.allMessages){var l=fTextToNode(a.message);if(!l)return;fReplaceOrInsertNode(l,r,BX.findChild(document,o,!0).parentNode,o),a.navigation&&a.pageNumber&&PostFormAjaxNavigation(a.navigation,a.pageNumber,a.pageCount),ClearForumPostForm(t),fRunScripts(a.message)}else if("undefined"!=typeof a.message)(msgNode=fTextToNode(a.message))&&(i?r.appendChild(msgNode):r.insertBefore(msgNode,r.firstChild)),ClearForumPostForm(t),fRunScripts(a.message);else if(a.previewMessage){previewDIV=BX.findChild(document,{className:"reviews-preview"},!0),previewParent=BX.findChild(document,{className:/reviews-reply-form|reviews-collapse/},!0).parentNode;var c=fTextToNode(a.previewMessage);fReplaceOrInsertNode(c,previewDIV,previewParent,{className:/reviews-reply-form|reviews-collapse/}),PostFormAjaxStatus(""),fRunScripts(a.previewMessage)}a.messageID&&(message=BX("message"+a.messageID))&&BX.scrollToNode(message)}for(var d=t.getElementsByTagName("input"),u=0;u<d.length;u++){var h=d[u];"submit"==h.getAttribute("type")&&(h.disabled=!1)}(input_pageno=BX.findChild(t,{attr:{name:"pageNumber"}},!0))&&BX.remove(input_pageno),a.statusMessage&&PostFormAjaxStatus(a.statusMessage),BX.onCustomEvent(window,"onAfterForumCommentAJAXPost",[a,t])}function ClearForumPostForm(e){if("code"==window.oLHE.sEditorMode?window.oLHE.SetContent(""):window.oLHE.SetEditorContent(""),window.oLHE.fAutosave&&BX.bind(window.oLHE.pEditorDocument,"keydown",BX.proxy(window.oLHE.fAutosave.Init,window.oLHE.fAutosave)),BX.type.isDomNode(e)){(previewDIV=BX.findChild(document,{className:"reviews-preview"},!0))&&BX.remove(previewDIV);for(var t=0;fileDIV=BX("upload_files_"+t++ +"_");)(fileINPUT=BX.findChild(fileDIV,{tag:"input"}))&&(fileINPUT.value=""),BX.hide(fileDIV);var i=BX.findChild(e,{className:"forum-upload-file-attach"},!0);i&&BX.show(i);var a=BX.findChild(e,{className:"reviews-upload-info"},!0);a&&BX.hide(a),captchaIMAGE=null,captchaHIDDEN=BX.findChild(e,{attr:{name:"captcha_code"}},!0),captchaINPUT=BX.findChild(e,{attr:{name:"captcha_word"}},!0),captchaDIV=BX.findChild(e,{className:"reviews-reply-field-captcha-image"},!0),captchaDIV&&(captchaIMAGE=BX.findChild(captchaDIV,{tag:"img"})),captchaHIDDEN&&captchaINPUT&&captchaIMAGE&&(captchaINPUT.value="",BX.ajax.getCaptcha(function(e){captchaHIDDEN.value=e.captcha_sid,captchaIMAGE.src="/bitrix/tools/captcha.php?captcha_code="+e.captcha_sid}))}}function ValidateForm(e,t,i,a){if(e.BXFormSubmit_save)return!0;if("object"!=typeof e||"object"!=typeof e.REVIEW_TEXT)return!1;"undefined"==typeof oForum&&(oForum={}),MessageMax=64e3;var o="",s=e.REVIEW_TEXT.value.length;if(e.TITLE&&e.TITLE.value.length<2&&(o+=oErrors.no_topic_name),2>s?o+=oErrors.no_message:0!=MessageMax&&s>MessageMax&&(o+=oErrors.max_len.replace(/\#MAX_LENGTH\#/gi,MessageMax).replace(/\#LENGTH\#/gi,s)),""!=o)return alert(o),!1;var r=BX.findChild(e,{attribute:{name:"send_button"}},!0);r&&(r.disabled=!0);var n=BX.findChild(e,{attribute:{name:"view_button"}},!0);if(n&&(n.disabled=!0),"Y"==t&&window.ForumPostMessage&&ForumPostMessage(e),"Y"==i){var l=e,c="Y"==a;if("undefined"!=typeof oForum&&"undefined"!=typeof oForum.page_number){var d=BX.findChild(l,{attr:{name:"pageNumber"}});d?d.value=oForum.page_number:(d=BX.create("input",{props:{type:"hidden",name:"pageNumber"}}),d.value=oForum.page_number,l.appendChild(d))}if("undefined"!=typeof oForum&&"undefined"!=typeof oForum.page_count){var u=BX.findChild(l,{attr:{name:"pageCount"}});u?u.value=oForum.page_count:(u=BX.create("input",{props:{type:"hidden",name:"pageCount"}}),u.value=oForum.page_count,l.appendChild(u))}return BX.onCustomEvent(window,"onBeforeForumCommentAJAXPost",[l]),setTimeout(function(){BX.ajax.submit(l,function(e){PostFormAjaxResponse(e,l,c)})},50),!1}return!0}function ShowLastEditReason(e,t){t&&(e?t.style.display="block":t.style.display="none")}function AttachFile(e,t,i,a){var o=null,s=!1;e=parseInt(e),t=parseInt(t),document.getElementById("upload_files_info_"+i).style.display="block";for(var r=e;e+t>r&&(o=document.getElementById("upload_files_"+r+"_"+i),o&&null!=typeof o);r++)if("none"==o.style.display){s=!0,o.style.display="block";break}var n=s?r>=e+t-1:!0;1==n&&(a.style.display="none")}function quoteMessageEx(e,t){function i(e,t,i){for(var a=new RegExp("([^]*)("+t+")([^]*)","i"),o=new RegExp("((?:)(?:[^]*))("+t+")((?:[^]*)(?:))","i"),s=0;s++<300&&e.search(a)>=0;)e=e.replace(o,"$1"+i+"$3");return e}replyForumFormOpen();var a="",o=0;if(a=GetSelection(),document.getSelection&&(a=a.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," "),a=a.replace(/  /gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")),""==a&&t)if(o=parseInt(t.replace(/message_text_/gi,"")),o>0){var s=document.getElementById(t);"object"==typeof s&&s&&(a=s.innerHTML)}else t.length>0&&(a=t);if(""!=a){a=a.replace(/[\n|\r]*\<br(\s)*(\/)*\>/gi,"\n");var r=function(e,t){var i=" ",a=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi;if(res=a.exec(t),res&&(i="[VIDEO WIDTH="+res[2]+" HEIGHT="+res[3]+"]"+res[1]+"[/VIDEO]")," "==i){var o=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi;res=o.exec(t),res&&(i="[VIDEO WIDTH="+res[3]+" HEIGHT="+res[2]+"]"+res[1]+"[/VIDEO]")}return i};a=a.replace(/\<script[^\>]*>/gi,"").replace(/\<\/script[^\>]*>/gi,""),a=a.replace(/\001([^\002]*)\002/gi,r),a=a.replace(/\<noscript[^\>]*>/gi,"").replace(/\<\/noscript[^\>]*>/gi,""),a=a.replace(/\003([^\004]*)\004/gi," "),a=a.replace(/\<table class\=[\"]*forum-quote[\"]*\>[^<]*\<thead\>[^<]*\<tr\>[^<]*\<th\>([^<]+)\<\/th\>\<\/tr\>\<\/thead\>[^<]*\<tbody\>[^<]*\<tr\>[^<]*\<td\>/gi,""),a=a.replace(/\<table class\=[\"]*forum-code[\"]*\>[^<]*\<thead\>[^<]*\<tr\>[^<]*\<th\>([^<]+)\<\/th\>\<\/tr\>\<\/thead\>[^<]*\<tbody\>[^<]*\<tr\>[^<]*\<td\>/gi,""),a=a.replace(/\<table class\=[\"]*data-table[\"]*\>[^<]*\<tbody\>/gi,""),a=a.replace(/\<\/td\>[^<]*\<\/tr\>(\<\/tbody\>)*\<\/table\>/gi,""),a=a.replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");for(var n=0;n++<50&&(a.search(/\002([^\002\003]*)\003/gi)>=0||a.search(/\001([^\001\003]*)\003/gi)>=0);)a=a.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]");for(var n=0;n++<10&&a.search(/\004([^\004\003]*)\003/gi)>=0;)a=i(a,"<tr>","[TR]"),a=i(a,"</tr>","[/TR]"),a=i(a,"<td>","[TD]"),a=i(a,"</td>","[/TD]"),a=a.replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]");if(a=BX.browser.IsIE()?a.replace(/\<img(?:(?:\s+alt\s*=\s*\"?smile([^\"\s]+)\"?)|(?:\s+\w+\s*=\s*[^\s\>]*))*\>/gi,"$1"):a.replace(/\<img.*?alt=[\"]*smile([^\"\s]+)[\"]*[^>]*\>/gi,"$1"),a=a.replace(/\<a[^>]+href=[\"]([^\"]+)\"[^>]+\>([^<]+)\<\/a\>/gi,"[URL=$1]$2[/URL]"),a=a.replace(/\<a[^>]+href=[\']([^\']+)\'[^>]+\>([^<]+)\<\/a\>/gi,"[URL=$1]$2[/URL]"),a=a.replace(/\<[^\>]+\>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"'),a=a.replace(/(smile(?=[:;8]))/g,""),a=a.replace(/\&shy;/gi,""),a=a.replace(/\&nbsp;/gi," "),null!=e&&e&&(a=e+oText.author+a),window.oLHE&&a){if("code"==window.oLHE.sEditorMode&&window.oLHE.bBBCode)window.oLHE.WrapWith("[QUOTE]","[/QUOTE]",a);else if("html"==window.oLHE.sEditorMode){var l=window.oLHE.bBBCode?"":' id"='+window.oLHE.SetBxTag(!1,{tag:"quote"})+'"';window.oLHE.InsertHTML('<blockquote class="bx-quote"'+l+">"+window.oLHE.ParseContent(a,!0)+"</blockquote><br/>")}window.oLHE.SetFocus(),BX.defer(window.oLHE.SetFocus,window.oLHE)()}}return!1}var GetSelection=function(){var e="";if("function"==typeof window.getSelection)try{var t=window.getSelection().getRangeAt(0).cloneContents(),i=BX.create("div");i.appendChild(t),e=i.innerHTML}catch(i){}else document.selection&&document.selection.createRange&&(e=document.selection.createRange().htmlText);return e};BX(function(){if(BX.browser.IsIE()){var e=BX.findChildren(document,{className:"reviews-post-table"},!0);if(!e)return;for(i in e)for(var t=e[i].getElementsByTagName("*"),i=t.length;i--;)t[i].scrollWidth>t[i].offsetWidth&&(t[i].style.paddingBottom="20px",t[i].style.overflowY="hidden")}});
