!function(e){e.JCIblockVoteStars||(JCIblockVoteStars=function(e){this.progressId=e.progressId,this.ratingId=e.ratingId,this.starsId=e.starsId,this.ajaxUrl=e.ajaxUrl,this.voteId=e.voteId,this.starsObj=null,this.votedValue=null,this.preVotedValue=null},JCIblockVoteStars.prototype.setValue=function(e){e=parseInt(e),isNaN(e)?e=0:e>100?e=100:0>e&&(e=0);var t=BX(this.progressId);t&&(t.style.width=parseInt(e)+"%",this.votedValue=e)},JCIblockVoteStars.prototype.setVotes=function(e){var t=BX(this.ratingId);t&&(t.innerHTML="( "+e+" )")},JCIblockVoteStars.prototype.getStarsObj=function(){return this.starsObj||(this.starsObj=BX(this.starsId)),this.starsObj},JCIblockVoteStars.prototype.onMouseMove=function(e){for(var t=BX.pos(this.getStarsObj()),a=(e.pageX-t.left)/t.width*5,o=1;5>=o;o++)if(o>a){a=o;break}this.setValue(20*a)},JCIblockVoteStars.prototype.onMouseOver=function(){BX.bind(this.getStarsObj(),"click",BX.proxy(this.onVote,this)),this.preVotedValue=this.votedValue},JCIblockVoteStars.prototype.onMouseOut=function(){BX.unbind(this.getStarsObj(),"click",BX.proxy(this.onVote,this)),this.votedValue=this.preVotedValue,this.setValue(this.votedValue)},JCIblockVoteStars.prototype.onVote=function(){this.unBindEvents(),this.ajaxParams.rating=parseInt(this.votedValue/20)-1,this.ajaxParams.vote="Y",this.ajaxParams.vote_id=this.voteId,BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:this.ajaxParams,onsuccess:BX.delegate(this.SetResult,this)})},JCIblockVoteStars.prototype.SetResult=function(e){e&&!e.ERROR&&(this.setValue(20*(e.value+1)),this.setVotes(e.votes))},JCIblockVoteStars.prototype.bindEvents=function(){var e=this.getStarsObj();BX.bind(e,"mousemove",BX.proxy(this.onMouseMove,this)),BX.bind(e,"mouseover",BX.proxy(this.onMouseOver,this)),BX.bind(e,"mouseout",BX.proxy(this.onMouseOut,this))},JCIblockVoteStars.prototype.unBindEvents=function(){var e=this.getStarsObj();BX.unbind(e,"mousemove",BX.proxy(this.onMouseMove,this)),BX.unbind(e,"mouseover",BX.proxy(this.onMouseOver,this)),BX.unbind(e,"mouseout",BX.proxy(this.onMouseOut,this)),BX.unbind(this.getStarsObj(),"click",BX.proxy(this.onVote,this))})}(window);
