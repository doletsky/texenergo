!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";function e(i,n){var a=function(){},s=this,o={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:e.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:a,onSearchComplete:a,onSearchError:a,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(t,e,i){return-1!==t.value.toLowerCase().indexOf(i)},paramName:"query",transformResult:function(e){return"string"==typeof e?t.parseJSON(e):e},showNoSuggestionNotice:!1,noSuggestionNotice:"No results"};s.element=i,s.el=t(i),s.suggestions=[],s.badQueries=[],s.selectedIndex=-1,s.currentValue=s.element.value,s.intervalId=0,s.cachedResponse={},s.onChangeInterval=null,s.onChange=null,s.isLocal=!1,s.suggestionsContainer=null,s.options=t.extend({},o,n),s.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},s.hint=null,s.hintValue="",s.selection=null,s.initialize(),s.setOptions(n)}var i=function(){return{escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(t){var e=document.createElement("div");return e.className=t,e.style.position="absolute",e.style.display="none",e}}}(),n={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};e.utils=i,t.Autocomplete=e,e.formatResult=function(t,e){var n="("+i.escapeRegExChars(e)+")";return t.value.replace(new RegExp(n,"gi"),"<strong>$1</strong>")},e.prototype={killerFn:null,initialize:function(){var i,n=this,a="."+n.classes.suggestion,s=n.classes.selected,o=n.options;n.element.setAttribute("autocomplete","off"),n.killerFn=function(e){0===t(e.target).closest("."+n.options.containerClass).length&&(n.killSuggestions(),n.disableKillerFn())},n.suggestionsContainer=e.utils.createNode(o.containerClass),i=t(n.suggestionsContainer),i.appendTo(o.appendTo),"auto"!==o.width&&i.width(o.width),i.on("mouseover.autocomplete",a,function(){n.activate(t(this).data("index"))}),i.on("mouseout.autocomplete",function(){n.selectedIndex=-1,i.children("."+s).removeClass(s)}),i.on("click.autocomplete",a,function(){n.select(t(this).data("index"))}),n.fixPosition(),n.fixPositionCapture=function(){n.visible&&n.fixPosition()},t(window).on("resize.autocomplete",n.fixPositionCapture),n.el.on("keydown.autocomplete",function(t){n.onKeyPress(t)}),n.el.on("keyup.autocomplete",function(t){n.onKeyUp(t)}),n.el.on("blur.autocomplete",function(){n.onBlur()}),n.el.on("focus.autocomplete",function(){n.onFocus()}),n.el.on("change.autocomplete",function(t){n.onKeyUp(t)})},onFocus:function(){var t=this;t.fixPosition(),t.options.minChars<=t.el.val().length&&t.onValueChange()},onBlur:function(){this.enableKillerFn()},setOptions:function(e){var i=this,n=i.options;t.extend(n,e),i.isLocal=t.isArray(n.lookup),i.isLocal&&(n.lookup=i.verifySuggestionsFormat(n.lookup)),t(i.suggestionsContainer).css({"max-height":n.maxHeight+"px",width:n.width+"px","z-index":n.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var t=this;t.disabled=!0,t.currentRequest&&t.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var e,i,n=this;"body"===n.options.appendTo&&(e=n.el.offset(),i={top:e.top+n.el.outerHeight()+"px",left:e.left+"px"},"auto"===n.options.width&&(i.width=n.el.outerWidth()-2+"px"),t(n.suggestionsContainer).css(i))},enableKillerFn:function(){var e=this;t(document).on("click.autocomplete",e.killerFn)},disableKillerFn:function(){var e=this;t(document).off("click.autocomplete",e.killerFn)},killSuggestions:function(){var t=this;t.stopKillSuggestions(),t.intervalId=window.setInterval(function(){t.hide(),t.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var t,e=this,i=e.el.val().length,n=e.element.selectionStart;return"number"==typeof n?n===i:document.selection?(t=document.selection.createRange(),t.moveStart("character",-i),i===t.text.length):!0},onKeyPress:function(t){var e=this;if(!e.disabled&&!e.visible&&t.which===n.DOWN&&e.currentValue)return void e.suggest();if(!e.disabled&&e.visible){switch(t.which){case n.ESC:e.el.val(e.currentValue),e.hide();break;case n.RIGHT:if(e.hint&&e.options.onHint&&e.isCursorAtEnd()){e.selectHint();break}return;case n.TAB:if(e.hint&&e.options.onHint)return void e.selectHint();case n.RETURN:if(-1===e.selectedIndex)return void e.hide();if(e.select(e.selectedIndex),t.which===n.TAB&&e.options.tabDisabled===!1)return;break;case n.UP:e.moveUp();break;case n.DOWN:e.moveDown();break;default:return}t.stopImmediatePropagation(),t.preventDefault()}},onKeyUp:function(t){var e=this;if(!e.disabled){switch(t.which){case n.UP:case n.DOWN:return}clearInterval(e.onChangeInterval),e.currentValue!==e.el.val()&&(e.findBestHint(),e.options.deferRequestBy>0?e.onChangeInterval=setInterval(function(){e.onValueChange()},e.options.deferRequestBy):e.onValueChange())}},onValueChange:function(){var e,i=this,n=i.options,a=i.el.val(),s=i.getQuery(a);return i.selection&&(i.selection=null,(n.onInvalidateSelection||t.noop).call(i.element)),clearInterval(i.onChangeInterval),i.currentValue=a,i.selectedIndex=-1,n.triggerSelectOnValidInput&&(e=i.findSuggestionIndex(s),-1!==e)?void i.select(e):void(s.length<n.minChars?i.hide():i.getSuggestions(s))},findSuggestionIndex:function(e){var i=this,n=-1,a=e.toLowerCase();return t.each(i.suggestions,function(t,e){return e.value.toLowerCase()===a?(n=t,!1):void 0}),n},getQuery:function(e){var i,n=this.options.delimiter;return n?(i=e.split(n),t.trim(i[i.length-1])):e},getSuggestionsLocal:function(e){var i,n=this,a=n.options,s=e.toLowerCase(),o=a.lookupFilter,r=parseInt(a.lookupLimit,10);return i={suggestions:t.grep(a.lookup,function(t){return o(t,e,s)})},r&&i.suggestions.length>r&&(i.suggestions=i.suggestions.slice(0,r)),i},getSuggestions:function(e){var i,n,a,s=this,o=s.options,r=o.serviceUrl;if(o.params[o.paramName]=e,n=o.ignoreParams?null:o.params,s.isLocal?i=s.getSuggestionsLocal(e):(t.isFunction(r)&&(r=r.call(s.element,e)),a=r+"?"+t.param(n||{}),i=s.cachedResponse[a]),i&&t.isArray(i.suggestions))s.suggestions=i.suggestions,s.suggest();else if(!s.isBadQuery(e)){if(o.onSearchStart.call(s.element,o.params)===!1)return;s.currentRequest&&s.currentRequest.abort(),s.currentRequest=t.ajax({url:r,data:n,type:o.type,dataType:o.dataType}).done(function(t){var i;s.currentRequest=null,i=o.transformResult(t),s.processResponse(i,e,a),o.onSearchComplete.call(s.element,e,i.suggestions)}).fail(function(t,i,n){o.onSearchError.call(s.element,e,t,i,n)})}},isBadQuery:function(t){if(!this.options.preventBadQueries)return!1;for(var e=this.badQueries,i=e.length;i--;)if(0===t.indexOf(e[i]))return!0;return!1},hide:function(){var e=this;e.visible=!1,e.selectedIndex=-1,t(e.suggestionsContainer).hide(),e.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void(this.options.showNoSuggestionNotice?this.noSuggestions():this.hide());var e,i=this,n=i.options,a=n.formatResult,s=i.getQuery(i.currentValue),o=i.classes.suggestion,r=i.classes.selected,l=t(i.suggestionsContainer),c=n.beforeRender,h="";return n.triggerSelectOnValidInput&&(e=i.findSuggestionIndex(s),-1!==e)?void i.select(e):(t.each(i.suggestions,function(t,e){h+='<div class="'+o+'" data-index="'+t+'">'+a(e,s)+"</div>"}),this.adjustContainerWidth(),l.html(h),n.autoSelectFirst&&(i.selectedIndex=0,l.children().first().addClass(r)),t.isFunction(c)&&c.call(i.element,l),l.show(),i.visible=!0,void i.findBestHint())},noSuggestions:function(){var e=this,i=t(e.suggestionsContainer),n="";n+='<div class="autocomplete-no-suggestion">'+this.options.noSuggestionNotice+"</div>",this.adjustContainerWidth(),i.html(n),i.show(),e.visible=!0},adjustContainerWidth:function(){var e,i=this,n=i.options,a=t(i.suggestionsContainer);"auto"===n.width&&(e=i.el.outerWidth()-2,a.width(e>0?e:300))},findBestHint:function(){var e=this,i=e.el.val().toLowerCase(),n=null;i&&(t.each(e.suggestions,function(t,e){var a=0===e.value.toLowerCase().indexOf(i);return a&&(n=e),!a}),e.signalHint(n))},signalHint:function(e){var i="",n=this;e&&(i=n.currentValue+e.value.substr(n.currentValue.length)),n.hintValue!==i&&(n.hintValue=i,n.hint=e,(this.options.onHint||t.noop)(i))},verifySuggestionsFormat:function(e){return e.length&&"string"==typeof e[0]?t.map(e,function(t){return{value:t,data:null}}):e},processResponse:function(t,e,i){var n=this,a=n.options;t.suggestions=n.verifySuggestionsFormat(t.suggestions),a.noCache||(n.cachedResponse[i]=t,a.preventBadQueries&&0===t.suggestions.length&&n.badQueries.push(e)),e===n.getQuery(n.currentValue)&&(n.suggestions=t.suggestions,n.suggest())},activate:function(e){var i,n=this,a=n.classes.selected,s=t(n.suggestionsContainer),o=s.children();return s.children("."+a).removeClass(a),n.selectedIndex=e,-1!==n.selectedIndex&&o.length>n.selectedIndex?(i=o.get(n.selectedIndex),t(i).addClass(a),i):null},selectHint:function(){var e=this,i=t.inArray(e.hint,e.suggestions);e.select(i)},select:function(t){var e=this;e.hide(),e.onSelect(t)},moveUp:function(){var e=this;if(-1!==e.selectedIndex)return 0===e.selectedIndex?(t(e.suggestionsContainer).children().first().removeClass(e.classes.selected),e.selectedIndex=-1,e.el.val(e.currentValue),void e.findBestHint()):void e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var t=this;t.selectedIndex!==t.suggestions.length-1&&t.adjustScroll(t.selectedIndex+1)},adjustScroll:function(e){var i,n,a,s=this,o=s.activate(e),r=25;o&&(i=o.offsetTop,n=t(s.suggestionsContainer).scrollTop(),a=n+s.options.maxHeight-r,n>i?t(s.suggestionsContainer).scrollTop(i):i>a&&t(s.suggestionsContainer).scrollTop(i-s.options.maxHeight+r),s.el.val(s.getValue(s.suggestions[e].value)),s.signalHint(null))},onSelect:function(e){var i=this,n=i.options.onSelect,a=i.suggestions[e];i.currentValue=i.getValue(a.value),i.currentValue!==i.el.val()&&i.el.val(i.currentValue),i.signalHint(null),i.suggestions=[],i.selection=a,t.isFunction(n)&&n.call(i.element,a)},getValue:function(t){var e,i,n=this,a=n.options.delimiter;return a?(e=n.currentValue,i=e.split(a),1===i.length?t:e.substr(0,e.length-i[i.length-1].length)+t):t},dispose:function(){var e=this;e.el.off(".autocomplete").removeData("autocomplete"),e.disableKillerFn(),t(window).off("resize.autocomplete",e.fixPositionCapture),t(e.suggestionsContainer).remove()}},t.fn.autocomplete=function(i,n){var a="autocomplete";return 0===arguments.length?this.first().data(a):this.each(function(){var s=t(this),o=s.data(a);"string"==typeof i?o&&"function"==typeof o[i]&&o[i](n):(o&&o.dispose&&o.dispose(),o=new e(this,i),s.data(a,o))})}});
